<div class="content-block dx-card responsive-paddings">
  <dx-form id="form" [formData]="notas" [colCount]="1">

    <dxi-item class="buttons">
      <dx-button icon="undo" text="Voltar" [width]="136" (onClick)="voltar()">
      </dx-button>

      <dx-button icon="close" type="danger" text="Cancelar" [width]="136" (onClick)="cancelar()">
      </dx-button>

      <dx-button icon="check" type="success" text="Salvar" [width]="136" (onClick)="salvar()">
      </dx-button>
    </dxi-item>

    <dxi-item itemType="group" caption="Cadastro de Nota Fiscal">

      <div class="containerTextBox">
        <div class="autocomplete">
          <div class="autocomplete-input">
            <dxi-item dataField="nome do Cliente">
              <dx-autocomplete
                placeholder="Digite o nome para buscar o cliente..."
                [(value)]="clienteSalvo"
                [dataSource]="listaClientes"
                [searchExpr]="'nome'"
                [valueExpr]="'nome'"
                displayExpr="'nome'"
                (onValueChanged)="updateClientesInfo($event)"
                [width]="900">
              </dx-autocomplete>
            </dxi-item>


          </div>
        </div>

        <div class="dateBox">
          <dxi-item dataField="data de Emissão">
            <dx-date-box
              [inputAttr]="{ 'aria-label': 'Data da Nota' }"
              [width]="300"
              alignment="left"
              [value]="notas.data"
              displayFormat="dd/MM/yyyy">
            </dx-date-box>
          </dxi-item>
        </div>
      </div>

      <dxi-item>
        <dx-data-grid
          [dataSource]="dataSource"
          keyExpr="id"
          [columnAutoWidth]="true"
          [remoteOperations]="false"
          [allowColumnReordering]="true"
          [rowAlternationEnabled]="true"
          [showBorders]="true"
          (onRowInserted)="onRowInserted($event)"
          (onEditorPreparing)="onEditorPreparing($event)">


          <dxo-filter-row [visible]="true"></dxo-filter-row>
          <dxo-header-filter [visible]="true"></dxo-header-filter>
          <dxo-group-panel [visible]="true"></dxo-group-panel>
          <dxo-scrolling mode="virtual"></dxo-scrolling>

          <dxo-editing
            mode="row"
            [allowAdding]="true"
            [allowUpdating]="true"
            [allowDeleting]="true">
          </dxo-editing>

          <dxi-column
            caption="Ordem"
            dataField="items.ordenacao"
            dataType="number"
            alignment="left"
            [allowGrouping]="false"
            [allowEditing]="false"
            [width]="120"
            cssClass="bullet">
          </dxi-column>


          <dxi-column
            caption="Produto"
            alignment="left"
            [allowGrouping]="false"
            [width]="500"
            cssClass="bullet"
            cellTemplate="selectCellTemplate">
          </dxi-column>

          <div *dxTemplate="let d of 'selectCellTemplate'">
            <div class="chart-cell">
              <dx-select-box
                [dataSource]="dataSourceProdutos"
                [displayExpr]="'descricao'"
                [value]="produtoSelecionado"
                valueExpr="id"
                [searchMode]="searchModeOption"
                [searchExpr]="searchExprOption"
                [minSearchLength]="3"
                [searchEnabled]="true"
                [showDataBeforeSearch]="showDataBeforeSearchOption"
                [searchTimeout]="searchTimeoutOption"
                (onValueChanged)="onProdutoSelecionado($event)">
              </dx-select-box>
            </div>
          </div>


          <dxi-column
            caption="Quantidade"
            dataField="quantidade"
            dataType="number"
            alignment="left"
            [allowGrouping]="false"
            cssClass="bullet">
          </dxi-column>


          <dxi-column
            caption="Valor Unitário"
            dataField="valor_unitario"
            alignment="left"
            [allowGrouping]="false"
            [allowEditing]="false"
            cssClass="bullet"
            cellTemplate="valorUnitarioCellTemplate">
          </dxi-column>

          <div *dxTemplate="let d of 'valorUnitarioCellTemplate'">
            <div class="chart-cell">
              <dx-number-box
                [value]="valorProdutoSelecionado"
                [format]="'R$ #,##0.00'"
                [disabled]="true">
              </dx-number-box>
            </div>
          </div>

          <dxi-column
            caption="Valor Total"
            dataField="valor_total"
            dataType="number"
            alignment="left"
            [allowGrouping]="false"
            [allowEditing]="false"
            cssClass="bullet"
            cellTemplate="valorTotalCellTemplate">
          </dxi-column>

          <div *dxTemplate="let d of 'valorTotalCellTemplate'">
            <div class="chart-cell">
              <dx-number-box
                [value]="calcularValorTotal(d.data)"
                [format]="'$ #,##0.00'"
                [disabled]="true">
              </dx-number-box>
            </div>
          </div>

          <div *dxTemplate="let order of 'detail'">
          </div>

          <dxo-summary [calculateCustomSummary]="calculateSummary">
            <dxi-total-item
              name="сustomSummary1"
              summaryType="custom">
            </dxi-total-item>
            <dxi-total-item
              name="сustomSummary2"
              summaryType="custom">
            </dxi-total-item>
          </dxo-summary>
        </dx-data-grid>
      </dxi-item>

    </dxi-item>

  </dx-form>
</div>
